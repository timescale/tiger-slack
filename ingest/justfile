# Tiger Slack Ingest - Development Commands

# Default recipe - show available commands
default:
    @just --list

# Install dependencies
deps:
    uv sync

# Run the main ingest application
run:
    uv run python -m tiger_slack.main

# Run database migrations only
migrate:
    uv run python -m tiger_slack.migrations.runner

# Run scheduled jobs manually (user and channel sync)
jobs:
    uv run python -m tiger_slack.jobs

# Import historical Slack export data
import EXPORT_PATH:
    uv run python -m tiger_slack.import {{EXPORT_PATH}}

# Build the Docker image
build-image TAG="tiger-slack-ingest:latest":
    docker build -t {{TAG}} .

# Build and run with Docker
docker-run TAG="tiger-slack-ingest:latest":
    docker build -t {{TAG}} .
    docker run --rm -it {{TAG}}

# Run with Docker using environment file
docker-run-env TAG="tiger-slack-ingest:latest" ENV_FILE="../.env":
    docker build -t {{TAG}} .
    docker run --rm -it --env-file {{ENV_FILE}} {{TAG}}

# Clean up build artifacts
clean:
    rm -rf .venv
    rm -rf dist
    rm -rf __pycache__
    find . -name "*.pyc" -delete
    find . -name "*.pyo" -delete
    find . -name "__pycache__" -type d -exec rm -rf {} +

# Run ruff linter checks
lint:
    uv run ruff check .

# Run ruff linter checks and fix all auto-fixable issues
lint-fix:
    uv run ruff check . --fix

# Check formatting of the python source files (diff only)
format:
    uv run ruff format --diff .

# Format python source files and fix all auto-fixable issues
format-fix:
    uv run ruff format .

# Run pyright type checking
typecheck:
    uv run pyright

# Run pytest tests
test:
    uv run pytest

# Show package version
version:
    uv run python -c "from tiger_slack import __version__; print(__version__)"

# Build package wheel
build-wheel:
    uv build

# Show dependency tree
tree:
    uv tree